<script type="text/x-template" id="pagination_template">
    <nav>
        <ul class="pagination">
            
            <li class="(% p.classStr %)" v-repeat="p : pages">
                <a href="javascript:void(0);" v-on="click: butClick(p)">(%p.name%)</a>
            </li>

        </ul>
    </nav>
</script>
<script type="text/javascript">
var genPage = function(cfg){
    var pages = [];
    if(cfg.showFL){
        var obj = {};
        obj.name = "第一页";
        obj.targetPage = 1;
        if(cfg.currPage == 1){
            obj.classStr = "disabled";
            obj.canClick = false;
        }else{
            obj.classStr = "";
            obj.canClick = true;
        }
        pages.push(obj);
    }
    if(cfg.showFN){
        var obj = {};
        obj.name = "上一页";
        obj.targetPage = cfg.currPage - 1;
        if(cfg.currPage == 1){
            obj.classStr = "disabled";
            obj.canClick = false;
        }else{
            obj.classStr = "";
            obj.canClick = true;
        }
        pages.push(obj);
    }
    var center = parseInt(cfg.showPageNum/2);
    var showPageBegin = cfg.currPage > center ? (cfg.currPage - center) : 1;
    var showPageEnd = showPageBegin + cfg.showPageNum - 1;
    if(showPageEnd > cfg.endPage){
        showPageBegin = cfg.endPage - cfg.showPageNum + 1;
        showPageEnd = cfg.endPage;
    }
    for(; showPageBegin <= (showPageEnd); showPageBegin++){
        var obj = {};
        obj.name = showPageBegin;
        obj.targetPage = showPageBegin;
        obj.canClick = true;
        if(cfg.currPage == showPageBegin){
            obj.classStr = "active";
            obj.canClick = false;
        }
        pages.push(obj);
    }
    if(cfg.showFN){
        var obj = {};
        obj.name = "下一页";
        obj.targetPage = cfg.currPage + 1;
        if(cfg.currPage >= cfg.endPage){
            obj.classStr = "disabled";
            obj.canClick = false;
        }else{
            obj.classStr = "";
            obj.canClick = true;
        }
        pages.push(obj);
    }
    if(cfg.showFL){
        var obj = {};
        obj.name = "最后一页";
        obj.targetPage = cfg.endPage;
        if(cfg.currPage >= cfg.endPage){
            obj.classStr = "disabled";
            obj.canClick = false;
        }else{
            obj.classStr = "";
            obj.canClick = true;
        }
        pages.push(obj);

    }
     return pages;   
}
Vue.component('vue_pagination', {
    inherit: true,
    template: '#pagination_template',
    created: function(){
        var cfg = {
            showFL: true, //是否显示第一页,最后一页
            showFN: true, //是否显示上一页,下一页
            pageCount: 10, //每页几行
            resultCount: undefined, //总记录数,必须
            currPage: 1, //当前第几页
            showPageNum: 5, //显示几个页面按钮
            showGotoPage: true //是否显示直接跳转
        }
        if(!this.pagination || !this.pagination.resultCount){
            //错误,缺少必须参数
            return;
        }
        if(typeof (this.pagination.showFL) == "boolean"){
            cfg.showFL = this.pagination.showFL
        }
        if(typeof (this.pagination.showFN) == "boolean"){
            cfg.showFN = this.pagination.showFN
        }
        if(this.pagination.pageCount){
            cfg.pageCount = this.pagination.pageCount
        }
        cfg.resultCount = this.pagination.resultCount
        if(this.pagination.currPage){
            cfg.currPage = this.pagination.currPage
            if(cfg.currPage < 1){
                cfg.currPage = 1;
            }
        }
        if(this.pagination.showPageNum){
            cfg.showPageNum = this.pagination.showPageNum
        }
        if(this.pagination.showGotoPage){
            cfg.showGotoPage = this.pagination.showGotoPage
        }
        if(this.pagination.gotoPageFun){
            cfg.gotoPageFun = this.pagination.gotoPageFun;
        }
        
        cfg.endPage = parseInt(cfg.resultCount/cfg.pageCount) + (cfg.resultCount%cfg.pageCount > 0 ? 1: 0);
        
        this.$set("pagination_cfg", cfg);
	    this.$set("pages", genPage(cfg));
    },
    methods: {
        	butClick: function(page){
        	    if(page.canClick){
            	    this.pagination_cfg.currPage = page.targetPage;
        		    this.$set("pages", genPage(this.pagination_cfg));
        		    this.pagination_cfg.gotoPageFun(this.pagination_cfg.currPage);
            }
        	}
    }
});

</script>

{"version":3,"sources":["wysiwyg_m.coffee"],"names":[],"mappings":"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","file":"wysiwyg_m.js","sourceRoot":"/source/","sourcesContent":["$ ->\n    input = '<input id=\"image-file\" type=\"file\" />'\n    myCustomTemplates = image: (context) ->\n      locale = context.locale\n      options = context.options\n      '\n        <li>\n            <span id=\"file-span\" class=\"file-input btn btn-default btn-file glyphicon glyphicon-picture\">\n                <input id=\"image-file\" type=\"file\" />\n            </span>\n        </li>\n      '\n    #$('#wysiwyg').html('Some text dynamically set.')\n\n\n\n    selectFile = (e)->\n        files = e.target.files\n        for i of files\n            if !isNaN(i)\n                f = files[i]\n                fd = new FormData\n                fd.append 'file_' + i, f\n                # 把文件放入到 all_files列表和 fd上传队列中\n                new_file =\n                    'file_type': 'file'\n                    'file_name': f.name\n                    'remove': false\n                    'suffix': null\n                    'fd': fd\n        $.ajax(\n            url: '/file_upload'\n            type: 'POST'\n            data: new_file.fd\n            processData: false\n            contentType: false).done (d) =>\n                if d.error == '0'\n                    editor = $('#wysiwyg').data(\"wysihtml5\").editor\n\n                    file_path = d.results[0].file_path\n                    file_name = d.results[0].file_name\n                    log d.results[0]\n                    try\n                        editor.composer.commands.exec(\"insertImage\", { src: file_path, title: file_name, alt: file_name })\n                        editor.composer.commands.exec(\"insertLineBreak\")\n                        window.bz.showSuccess5 '文件上传成功'\n                        #add image\n                        #vue = $('#wysiwyg').data(\"vue\")\n                        log $('#wysiwyg').val()\n                        #vue.setRichText($('#wysiwyg').val())\n                    catch error\n                        log error\n                        window.bz.showError5 '请在编辑器中点击要插入图片的位置'\n                else\n                    window.bz.showError5 '文件上传时发生错误:' + d.error\n                $(this).remove()\n                $('#image-file').change (selectFile)\n                $(input).change(selectFile).appendTo($('#file-span'))\n                return\n    #window.bz.initWysiwyg()\n    window.bz.initWysiwyg = (vue=null)->\n        wysiwyg = $('#wysiwyg').wysihtml5 (\n            locale: 'zh-CN'\n            customTemplates: myCustomTemplates\n        )\n        $('#wysiwyg').data(\"vue\", vue)\n\n        editor = $('#wysiwyg').data(\"wysihtml5\").editor\n\n        editor.on(\"change\", ->\n            vue.setRichText($('#wysiwyg').val())\n        )\n        $('#image-file').change (selectFile)\n        return wysiwyg\n"]}